# Codebase Structure

**Analysis Date:** 2026-01-19

## Directory Layout

```
dolphin-reddit/
├── .planning/          # Planning and analysis documents
│   └── codebase/       # Architecture documentation
├── node_modules/       # NPM dependencies (not committed)
├── browse-reddit.js    # Main application (1882 lines)
├── config.js           # Configuration module
├── test-api.js         # Dolphin API test script
├── test-socket.js      # Socket.IO connection test
├── package.json        # NPM manifest
├── package-lock.json   # Dependency lock file
├── TESTING.md          # Manual testing checklist
└── dolphin-reddit-automation-spec.md  # Original specification
```

## Directory Purposes

**.planning/codebase/:**
- Purpose: Codebase analysis and architecture documentation
- Contains: ARCHITECTURE.md, STRUCTURE.md, and other analysis docs
- Key files: Generated by GSD mapping commands

**node_modules/:**
- Purpose: NPM dependencies
- Contains: puppeteer-core, socket.io-client, node-fetch-cookies
- Key files: Managed by npm, not committed to git

**Root Directory:**
- Purpose: All application code (flat structure)
- Contains: Source files, config, tests, documentation
- Key files: `browse-reddit.js`, `config.js`

## Key File Locations

**Entry Points:**
- `browse-reddit.js`: Main CLI application, REPL interface

**Configuration:**
- `config.js`: All configurable parameters (API, delays, limits, paths)

**Core Logic:**
- `browse-reddit.js`: Contains ALL application logic (monolithic)
  - Lines 13-56: State management
  - Lines 58-108: Logging system
  - Lines 110-135: Utility functions (delay, humanType, humanScroll)
  - Lines 136-302: Rate limiting
  - Lines 304-443: Detection (ban, captcha, rate limit)
  - Lines 445-532: Dolphin Anty API integration
  - Lines 534-591: Navigation
  - Lines 593-729: Content extraction
  - Lines 731-1327: Reddit actions
  - Lines 1329-1483: Account functions
  - Lines 1485-1541: Browsing helpers and undo
  - Lines 1543-1581: Status and info functions
  - Lines 1583-1784: Command processor
  - Lines 1786-1879: Main entry point

**Testing:**
- `test-api.js`: Tests Dolphin remote API connectivity
- `test-socket.js`: Tests Dolphin Socket.IO connection
- `TESTING.md`: Manual testing checklist with test cases

**Documentation:**
- `dolphin-reddit-automation-spec.md`: Original project specification
- `TESTING.md`: Testing procedures and troubleshooting

## Naming Conventions

**Files:**
- `kebab-case.js`: Source files (browse-reddit.js)
- `UPPERCASE.md`: Documentation files (TESTING.md)
- `kebab-case.md`: Specification documents (dolphin-reddit-automation-spec.md)

**Functions:**
- `camelCase`: All functions (e.g., `connectToProfile`, `extractPosts`, `checkForBan`)
- Prefixes: `get*` for queries, `check*` for validations, `extract*` for scraping

**Variables:**
- `camelCase`: Local variables and object properties
- `SCREAMING_SNAKE_CASE`: Not used (constants inline in config)

**Commands:**
- `lowercase`: CLI commands (e.g., `subreddit`, `upvote`, `createpost`)

## Where to Add New Code

**New Reddit Action:**
- Primary code: Add to `browse-reddit.js` in the appropriate action section (lines 731-1327)
- Add command registration in `commands` object (lines 1587-1654)
- Ensure `canPerformAction()` check at start of function
- Call `recordAction()` after successful execution
- Tests: Add to `TESTING.md` checklist

**New Extraction Function:**
- Implementation: Add to content extraction section (lines 593-729)
- Pattern: Use `page.evaluate()` with CSS selectors
- Register command in `commands` object
- Return structured data as object/array

**New Configuration Option:**
- Add to `config.js` in appropriate section
- Reference via `config.sectionName.optionName`
- Document in config file comments

**New Detection Check:**
- Add to detection section (lines 304-443)
- Pattern: `async function checkForX()` returning `{hasX: boolean, ...details}`
- Call from navigation or action functions as needed

**Utilities:**
- Shared helpers: Add to utility section (lines 110-135)
- Export if needed for test files (currently not modular)

## Special Directories

**./logs/ (runtime-created):**
- Purpose: Action log files
- Generated: Yes, by `ensureDir()` on startup
- Committed: No (should be gitignored)
- Contains: `actions-YYYY-MM-DD.log` JSON-line files

**./screenshots/ (runtime-created):**
- Purpose: Screenshot captures
- Generated: Yes, by `ensureDir()` on startup
- Committed: No (should be gitignored)
- Contains: `screenshot-*.png`, `error-*.png` files

**./data/ (runtime-created):**
- Purpose: Reserved for future data storage
- Generated: Yes, by `ensureDir()` on startup
- Committed: No (should be gitignored)
- Contains: Not currently used

## Import/Require Patterns

**Internal:**
```javascript
const config = require('./config');
```

**External:**
```javascript
const puppeteer = require('puppeteer-core');
const readline = require('readline');
const fs = require('fs');
const path = require('path');
```

**Socket.IO Test:**
```javascript
const { io } = require("socket.io-client");
```

## Configuration File Locations

**Application Config:**
- `config.js`: Primary configuration module

**NPM Config:**
- `package.json`: Dependencies and metadata
- `package-lock.json`: Dependency version lock

**Environment:**
- `DOLPHIN_TOKEN`: API token (set in environment or hardcoded in config.js)

## Runtime-Created Files

| Path | Purpose | Created By |
|------|---------|------------|
| `./logs/actions-*.log` | Daily action logs | `log()` function |
| `./screenshots/*.png` | Page captures | `screenshot()` function |
| `./data/` | Reserved directory | `main()` on startup |

---

*Structure analysis: 2026-01-19*
